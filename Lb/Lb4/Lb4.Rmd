---
title: "Лабораторна робота № 4. Перевірка статистичних гіпотез щодо закону розподілу"
author: "Мякушка Олександр"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    df_print: paged
  html_notebook:
    toc: true
    toc_float: true
    highlight: tango
editor_options:
  chunk_output_type: console
bibliography: references_lab.bib
---

```{r setup, include=FALSE}
# Підключення необхідних пакетів
library(ggplot2)
library(knitr)
library(nortest)
```
# 1. Постановка завдання

Метою роботи є дослідження випадкової величини $X$, що має нормальний закон розподілу $N(0, 1)$.Згідно з методичними вказівками, необхідно:Згенерувати вибірки обсягом $n=50$ та $n=1000$.Зберегти дані на диск та імпортувати їх для подальшого аналізу.Перевірити статистичну гіпотезу $H_0$ про нормальність розподілу за допомогою графічних та аналітичних методів.

#2. Користувацькі функції (Рівень 2)
Створимо власні інструменти для автоматизації розрахунків, як вимагає "Рівень 2" завдання.
```{r custom_func}
# Функція для оцінки асиметрії, ексцесу та Z-показників
calc_descriptive_metrics <- function(data) {
  n <- length(data)
  m <- mean(data)
  s <- sd(data)
  
  # Коефіцієнти за формулами методички
  skew_val <- sum((data - m)^3) / (n * sqrt((n-1)/n * s^2)^3)
  kurt_val <- sum((data - m)^4) / (n * ((n-1)/n * s^2)^2) - 3
  
  # Стандартизовані значення (z-scores)
  z_skew <- skew_val / sqrt(6/n)
  z_kurt <- kurt_val / sqrt(24/n)
  
  data.frame(
    Характеристика = c("Середнє", "СКВ", "Асиметрія", "Ексцес", "Z-Асиметрія", "Z-Ексцес"),
    Значення = round(c(m, s, skew_val, kurt_val, z_skew, z_kurt), 5)
  )
}

# Функція для зведеної таблиці тестів
run_normality_suite <- function(data) {
  sw <- shapiro.test(data)
  ks <- lillie.test(data)
  sf <- sf.test(data)
  cvm <- cvm.test(data)
  
  data.frame(
    Критерій = c("Шапіро-Вілка", "Лілієфорса (KS)", "Шапіро-Франсія", "Крамера-фон Мізеса"),
    Статистика = round(c(sw$statistic, ks$statistic, sf$statistic, cvm$statistic), 4),
    P_Value = round(c(sw$p.value, ks$p.value, sf$p.value, cvm$p.value), 4),
    Висновок = ifelse(c(sw$p.value, ks$p.value, sf$p.value, cvm$p.value) > 0.05, 
                      "Нормальний", "Відхилено")
  )
}
```
#3. Підготовка та імпорт даних
Згідно із зауваженням на стор. 36 методички, дані мають бути імпортовані з диску.
```{r c}
set.seed(2026) # Твій унікальний ідентифікатор

# Створення директорії та експорт
if(!dir.exists("data")) dir.create("data")

x50_gen <- rnorm(50, 0, 1)
x1000_gen <- rnorm(1000, 0, 1)

write.csv(data.frame(val = x50_gen), "data/sample50.csv", row.names = FALSE)
write.csv(data.frame(val = x1000_gen), "data/sample1000.csv", row.names = FALSE)

# Імпорт для аналізу
sample_50 <- read.csv("data/sample50.csv")$val
sample_1000 <- read.csv("data/sample1000.csv")$val
```
#4. Аналіз вибірки n = 50
```{r}
# Описова статистика
kable(calc_descriptive_metrics(sample_50), caption = "Таблиця 4.1 - Метрики для n=50")

# Перевірка гіпотез
kable(run_normality_suite(sample_50), caption = "Таблиця 4.2 - Результати тестів (n=50)")
```
#Комплексна візуалізація (n=50)
Виводимо 4 основні графіки, як показано на стор. 38-39 методички.
```{r}
op <- par(mfrow = c(2, 2))

# 1. Діаграма Клівленда
dotchart(sample_50, main = "Cleveland's Dot Plot", col = "darkgreen")

# 2. Boxplot (Ящик з вусами)
boxplot(sample_50, horizontal = TRUE, col = "lightblue", main = "Box-and-Whisker Plot")


# 3. Гістограма з кривими щільності
hist(sample_50, freq = FALSE, col = "snow2", main = "Histogram & Density Fits")
curve(dnorm(x, mean(sample_50), sd(sample_50)), col = "red", lwd = 2, add = TRUE)
curve(dunif(x, min(sample_50), max(sample_50)), col = "green", lty = 2, add = TRUE)
legend("topright", legend=c("Normal", "Uniform"), col=c("red", "green"), lty=1:2, cex=0.8)

# 4. Q-Q Plot для перевірки на нормальність
qqnorm(sample_50, pch = 18, col = "blue")
qqline(sample_50, col = "red", lwd = 2)


par(op)
```
#5. Аналіз вибірки n = 1000
Для великої вибірки оцінки зазвичай стають стабільнішими.
```{r}
kable(run_normality_suite(sample_1000), caption = "Тести на нормальність (n=1000)")

# Q-Q Plot для порівняння
qqnorm(sample_1000, main = "Normal Q-Q Plot (n=1000)", col = "darkblue")
qqline(sample_1000, col = "red")
```
#Висновки
На основі проведених тестів (Шапіро-Вілка, Лілієфорса), для обох вибірок значення $P-value > 0.05$.Це означає, що нульова гіпотеза $H_0$ про нормальний розподіл не відхиляється.Графічний аналіз (Q-Q Plot) підтверджує нормальність: точки переважно лежать на теоретичній прямій.